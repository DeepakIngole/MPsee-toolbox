function y = dHdu(x,TVP,TVP_f,u,tau,lmd,Con)
Xf1=TVP_f(1);
Xf2=TVP_f(2);
Xf3=TVP_f(3);
Xf4=TVP_f(4);
Xf5=TVP_f(5);
Xf6=TVP_f(6);
Xf7=TVP_f(7);
Xf8=TVP_f(8);
Xf9=TVP_f(9);
Xf10=TVP_f(10);
Xf11=TVP_f(11);
Xf12=TVP_f(12);
q1=TVP_f(13);
q2=TVP_f(14);
q3=TVP_f(15);
q4=TVP_f(16);
q5=TVP_f(17);
q6=TVP_f(18);
q7=TVP_f(19);
q8=TVP_f(20);
q9=TVP_f(21);
q10=TVP_f(22);
q11=TVP_f(23);
q12=TVP_f(24);
w1=TVP_f(25);
w2=TVP_f(26);
w3=TVP_f(27);
w4=TVP_f(28);
dt=TVP_f(29);
Xk1=x(1);
Xk2=x(2);
Xk3=x(3);
Xk4=x(4);
Xk5=x(5);
Xk6=x(6);
Xk7=x(7);
Xk8=x(8);
Xk9=x(9);
Xk10=x(10);
Xk11=x(11);
Xk12=x(12);
Uk1=u(1);
Uk2=u(2);
Uk3=u(3);
Uk4=u(4);
Lmdk1=lmd(1);
Lmdk2=lmd(2);
Lmdk3=lmd(3);
Lmdk4=lmd(4);
Lmdk5=lmd(5);
Lmdk6=lmd(6);
Lmdk7=lmd(7);
Lmdk8=lmd(8);
Lmdk9=lmd(9);
Lmdk10=lmd(10);
Lmdk11=lmd(11);
Lmdk12=lmd(12);
if nargin == 7
    con=Con(:,tau);
else
end
y=zeros(4,1);
y(1)=(20*Lmdk8)/3 + 100*Lmdk12 + (Uk1*w1)/2 + (w1*conj(Uk1))/2 + (5*Lmdk2*(sin(conj(Xk9))*sin(conj(Xk11)) + cos(conj(Xk9))*cos(conj(Xk11))*sin(conj(Xk7))))/7 - (5*Lmdk4*(cos(conj(Xk11))*sin(conj(Xk9)) - cos(conj(Xk9))*sin(conj(Xk7))*sin(conj(Xk11))))/7 + (5*Lmdk6*cos(conj(Xk7))*cos(conj(Xk9)))/7;
y(2)=100*Lmdk12 - (20*Lmdk8)/3 + (Uk2*w2)/2 + (w2*conj(Uk2))/2 + (5*Lmdk2*(sin(conj(Xk9))*sin(conj(Xk11)) + cos(conj(Xk9))*cos(conj(Xk11))*sin(conj(Xk7))))/7 - (5*Lmdk4*(cos(conj(Xk11))*sin(conj(Xk9)) - cos(conj(Xk9))*sin(conj(Xk7))*sin(conj(Xk11))))/7 + (5*Lmdk6*cos(conj(Xk7))*cos(conj(Xk9)))/7;
y(3)=(20*Lmdk10)/3 - 100*Lmdk12 + (Uk3*w3)/2 + (w3*conj(Uk3))/2 + (5*Lmdk2*(sin(conj(Xk9))*sin(conj(Xk11)) + cos(conj(Xk9))*cos(conj(Xk11))*sin(conj(Xk7))))/7 - (5*Lmdk4*(cos(conj(Xk11))*sin(conj(Xk9)) - cos(conj(Xk9))*sin(conj(Xk7))*sin(conj(Xk11))))/7 + (5*Lmdk6*cos(conj(Xk7))*cos(conj(Xk9)))/7;
y(4)=(Uk4*w4)/2 - 100*Lmdk12 - (20*Lmdk10)/3 + (w4*conj(Uk4))/2 + (5*Lmdk2*(sin(conj(Xk9))*sin(conj(Xk11)) + cos(conj(Xk9))*cos(conj(Xk11))*sin(conj(Xk7))))/7 - (5*Lmdk4*(cos(conj(Xk11))*sin(conj(Xk9)) - cos(conj(Xk9))*sin(conj(Xk7))*sin(conj(Xk11))))/7 + (5*Lmdk6*cos(conj(Xk7))*cos(conj(Xk9)))/7;
