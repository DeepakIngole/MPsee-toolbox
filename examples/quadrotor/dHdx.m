function y = dHdx(x,TVP,TVP_f,u,tau,lmd,Con)
Xf1=TVP_f(1);
Xf2=TVP_f(2);
Xf3=TVP_f(3);
Xf4=TVP_f(4);
Xf5=TVP_f(5);
Xf6=TVP_f(6);
Xf7=TVP_f(7);
Xf8=TVP_f(8);
Xf9=TVP_f(9);
Xf10=TVP_f(10);
Xf11=TVP_f(11);
Xf12=TVP_f(12);
q1=TVP_f(13);
q2=TVP_f(14);
q3=TVP_f(15);
q4=TVP_f(16);
q5=TVP_f(17);
q6=TVP_f(18);
q7=TVP_f(19);
q8=TVP_f(20);
q9=TVP_f(21);
q10=TVP_f(22);
q11=TVP_f(23);
q12=TVP_f(24);
w1=TVP_f(25);
w2=TVP_f(26);
w3=TVP_f(27);
w4=TVP_f(28);
dt=TVP_f(29);
Xk1=x(1);
Xk2=x(2);
Xk3=x(3);
Xk4=x(4);
Xk5=x(5);
Xk6=x(6);
Xk7=x(7);
Xk8=x(8);
Xk9=x(9);
Xk10=x(10);
Xk11=x(11);
Xk12=x(12);
Uk1=u(1);
Uk2=u(2);
Uk3=u(3);
Uk4=u(4);
Lmdk1=lmd(1);
Lmdk2=lmd(2);
Lmdk3=lmd(3);
Lmdk4=lmd(4);
Lmdk5=lmd(5);
Lmdk6=lmd(6);
Lmdk7=lmd(7);
Lmdk8=lmd(8);
Lmdk9=lmd(9);
Lmdk10=lmd(10);
Lmdk11=lmd(11);
Lmdk12=lmd(12);
y=zeros(12,1);
if nargin == 7
    con=Con(:,tau);
else
end
y(1)=- (q1*(Xf1 - Xk1))/2 - q1*(conj(Xf1)/2 - conj(Xk1)/2);
y(2)=Lmdk1 - (q2*(Xf2 - Xk2))/2 - q2*(conj(Xf2)/2 - conj(Xk2)/2);
y(3)=- (q3*(Xf3 - Xk3))/2 - q3*(conj(Xf3)/2 - conj(Xk3)/2);
y(4)=Lmdk3 - (q4*(Xf4 - Xk4))/2 - q4*(conj(Xf4)/2 - conj(Xk4)/2);
y(5)=- (q5*(Xf5 - Xk5))/2 - q5*(conj(Xf5)/2 - conj(Xk5)/2);
y(6)=Lmdk5 - (q6*(Xf6 - Xk6))/2 - q6*(conj(Xf6)/2 - conj(Xk6)/2);
y(7)=(5*Lmdk2*cos(conj(Xk7))*cos(conj(Xk9))*cos(conj(Xk11))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7 - q7*(conj(Xf7)/2 - conj(Xk7)/2) - (5*Lmdk6*cos(conj(Xk9))*sin(conj(Xk7))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7 - (q7*(Xf7 - Xk7))/2 + (5*Lmdk4*cos(conj(Xk7))*cos(conj(Xk9))*sin(conj(Xk11))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7;
y(8)=Lmdk7 - (q8*(Xf8 - Xk8))/2 - q8*(conj(Xf8)/2 - conj(Xk8)/2);
y(9)=(5*Lmdk2*(cos(conj(Xk9))*sin(conj(Xk11)) - cos(conj(Xk11))*sin(conj(Xk7))*sin(conj(Xk9)))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7 - q9*(conj(Xf9)/2 - conj(Xk9)/2) - (q9*(Xf9 - Xk9))/2 - (5*Lmdk4*(cos(conj(Xk9))*cos(conj(Xk11)) + sin(conj(Xk7))*sin(conj(Xk9))*sin(conj(Xk11)))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7 - (5*Lmdk6*cos(conj(Xk7))*sin(conj(Xk9))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7;
y(10)=Lmdk9 - (q10*(Xf10 - Xk10))/2 - q10*(conj(Xf10)/2 - conj(Xk10)/2);
y(11)=(5*Lmdk2*(cos(conj(Xk11))*sin(conj(Xk9)) - cos(conj(Xk9))*sin(conj(Xk7))*sin(conj(Xk11)))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7 - q11*(conj(Xf11)/2 - conj(Xk11)/2) - (q11*(Xf11 - Xk11))/2 + (5*Lmdk4*(sin(conj(Xk9))*sin(conj(Xk11)) + cos(conj(Xk9))*cos(conj(Xk11))*sin(conj(Xk7)))*(conj(Uk1) + conj(Uk2) + conj(Uk3) + conj(Uk4)))/7;
y(12)=Lmdk11 - (q12*(Xf12 - Xk12))/2 - q12*(conj(Xf12)/2 - conj(Xk12)/2);
